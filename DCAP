from google.colab import files
uploaded = files.upload()  
import pandas as pd
import numpy as np
from pathlib import Path
import traceback
import glob

def find_csv():
    candidates = glob.glob("*.csv")
    if not candidates:
        raise FileNotFoundError("No CSV file found in the current directory. Please upload one.")
    return Path(candidates[0])

def clean_data(input_path: Path, output_path: Path):
    df = pd.read_csv(input_path)

    df['Age'] = df['Age'].fillna(df['Age'].median())
    df['Gender'] = df['Gender'].replace({'M': 'Male', 'F': 'Female'})
    df['Gender'] = df['Gender'].fillna('Unknown')
    df['City'] = df['City'].str.title()
    df['City'] = df['City'].fillna('Unknown')
    df['Account_Status'] = df['Account_Status'].fillna('Unknown')
    df['Feedback'] = df['Feedback'].fillna('No Feedback')

    df['Signup_Date'] = pd.to_datetime(df['Signup_Date'], errors='coerce', dayfirst=True)
    df['Last_Login'] = pd.to_datetime(df['Last_Login'], errors='coerce')
    df['Signup_Date'] = df['Signup_Date'].fillna(df['Signup_Date'].min())
    df['Last_Login'] = df['Last_Login'].fillna(df['Last_Login'].max())

    for col in ['Age', 'Annual_Income', 'Loyalty_Score']:
        Q1 = df[col].quantile(0.25)
        Q3 = df[col].quantile(0.75)
        IQR = Q3 - Q1
        lower = Q1 - 1.5 * IQR
        upper = Q3 + 1.5 * IQR
        df[col] = np.where(df[col] < lower, lower, np.where(df[col] > upper, upper, df[col]))

    df.to_csv(output_path, index=False)
    print("Cleaned data written to {}".format(output_path))

try:
    input_path = find_csv()
    output_path = Path("cleaned_dataset.csv")
    clean_data(input_path, output_path)
except Exception:
    traceback.print_exc()
from google.colab import files
files.download("cleaned_dataset.csv")
